///////////////////////////////////////////////////////////////////
//  IDE: TMW-Maker v0.2
//  MODIFICADO: 29/05/2011 10:30 AM
///////////////////////////////////////////////////////////////////

005-3.gat,46,146,0	script	Seu Agirrab	322,{
///////////////////////////////////////////////////////////////////
//  PROGRAMADOR: Lunovox
//  REVISÃO: Alastrim
//  ACRIAÇÃO: 01/01/2011 8:04 AM
//  UTILIDADE DO SCRIPT:
//    * Aluga por 5kGP um dos quartos de pensão que foi 
//      escolhido pelo player por 7 dias.
///////////////////////////////////////////////////////////////////

_inicio:
	if ($RESET_PB == 0) goto _ResetPB;
	set @MaxQuartos, 29;
	set @SegAlugados, 604800;
	set $PB_Custo, 0;
	set @PB_Custo, 5000;
	if (Agirrab_Capitulo != 0) set Agirrab_Capitulo, 0;
	if ($PB_Ocupados != 0) set $PB_Ocupados, 0;
	if (QUEST_MASK1 & MASK1_AGIRRAB) goto _pergunta;

_apresentacao:
	mes "[Seu Agirrab]";
	mes "\"Olá "+ strcharinfo(0) +"! "+
	    "Eu possuo uma grande pensão aqui na ilha. "+
	    "Você quer alugar um quarto?\"";
	next;
	mes "["+ strcharinfo(0) +"]";
	mes "\"Eu não preciso disso. "+
		"Para que eu vou querer uma quarto?\"";
	next;
	mes "[Seu Agirrab]";
	mes "\"Você poderá fazer reuniões com seus amigos em uma sala trancada por uma senha de sua escolha."+
		"Também poderá guardar seus itens e seu dinheiro sem pagar nenhuma taxa adicional.\"";
	next;
	set QUEST_MASK1, (QUEST_MASK1 | MASK1_AGIRRAB);
	goto _pergunta;

_sem_vagas:
	mes "[Seu Agirrab]";
	mes "\"A Pensão Bhramir esté sem vagas no momento. Venha me procurar mais tarde!\"";
	next;
	mes "[Seu Agirrab]";
	mes "\"Mesmo assim, deseja ver a lista dos locatários?\"";
	next;
	mes "["+ strcharinfo(0) +"]";
	menu
	"Quero sim.", _listarLocatarios,
	"Não estou precisando.", _nao_precisa;
	goto _nao_precisa;

_pergunta:
	mes "[Seu Agirrab]";
	mes "\"Você quer alugar um quarto por "+ @PB_Custo +" GP durante sete dias?\"";
	next;
	mes "["+ strcharinfo(0) +"]";
	menu
	"Quero sim.", _PreLocatarios,
	"Não estou precisando.", _nao_precisa;
	close;

_PreLocatarios:
        setarray @menuitems$[1], "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "";
        set @p, 0;
	set @ocupados, 0;
_LoopLocatarios:
	if (@p > 29) goto _TempoLocacao;
	set @resta, $PB_Vencimentos[@p] - gettimetick(2);
	set @dias, @resta/86400;
	set @horas, (@resta - (@dias*86400))/3600;
	set @minutos, (@resta - (@dias*86400) - (@horas*3600))/60;
	set @segundos, (@resta - (@dias*86400) - (@horas*3600) - (@minutos*60));
        if ($PB_Inquilinos$[@p] != "") set @menuitems$[@p], $PB_Inquilinos$[@p] + "("+@dias+" dias, "+@horas+" hs., "+@minutos+" Min. e "+@segundos+" Seg.";
        if ($PB_Inquilinos$[@p] == "") set @menuitems$[@p], " Desocupado";
	set @p, @p+1;
	if ($PB_Inquilinos$[@p] != "") set @ocupados, @ocupados + 1;
	goto _LoopLocatarios;

_MostraLocatarios:
	if (@ocupados >= 29) goto _sem_vagas;
	mes "[LISTA DE QUARTOS]";
	menu
	@menuitems$[1]+" => (Quarto N. 1)", -,
	@menuitems$[2]+" => (Quarto N. 2)", -,
	@menuitems$[3]+" => (Quarto N. 3)", -,
	@menuitems$[4]+" => (Quarto N. 4)", -,
	@menuitems$[5]+" => (Quarto N. 5)", -,
	@menuitems$[6]+" => (Quarto N. 6)", -,
	@menuitems$[7]+" => (Quarto N. 7)", -,
	@menuitems$[8]+" => (Quarto N. 8)", -,
	@menuitems$[9]+" => (Quarto N. 9)", -,
	@menuitems$[10]+" => (Quarto N. 10)", -,
	@menuitems$[11]+" => (Quarto N. 11)", -,
	@menuitems$[12]+" => (Quarto N. 12)", -,
	@menuitems$[13]+" => (Quarto N. 13)", -,
	@menuitems$[14]+" => (Quarto N. 14)", -,
	@menuitems$[15]+" => (Quarto N. 15)", -,
	@menuitems$[16]+" => (Quarto N. 16)", -,
	@menuitems$[17]+" => (Quarto N. 17)", -,
	@menuitems$[18]+" => (Quarto N. 18)", -,
	@menuitems$[19]+" => (Quarto N. 19)", -,
	@menuitems$[20]+" => (Quarto N. 20)", -,
	@menuitems$[21]+" => (Quarto N. 21)", -,
	@menuitems$[22]+" => (Quarto N. 22)", -,
	@menuitems$[23]+" => (Quarto N. 23)", -,
	@menuitems$[24]+" => (Quarto N. 24)", -,
	@menuitems$[25]+" => (Quarto N. 25)", -,
	@menuitems$[26]+" => (Quarto N. 26)", -,
	@menuitems$[27]+" => (Quarto N. 27)", -,
	@menuitems$[28]+" => (Quarto N. 28)", -,
	@menuitems$[29]+" => (Quarto N. 29)", -,
	"Ok! Ja vi todos!", _nao_precisa;

	goto _testQuarto;

_nao_precisa:
	mes "[Seu Agirrab]";
	mes "Ok! Até a próxima, então!";
	close;

//----------------------------------------------------------------------------------------------------------------

_testQuarto:
	set @QuartosSelecionado, @menu;
	if ($PB_Inquilinos$[@QuartosSelecionado] != "") goto _quartoOcupado;
	mes "[Seu Agirrab]";
	mes "\"Vai querer alugar este quarto?\"";
	menu
		"Sim! Quero o nº "+@QuartosSelecionado+"!", _quartoAlugar,
		"Talvês! Quero ver a lista novamente!", _PreLocatarios,
		"Não! Desisti de alugar!.", _nao_precisa;
	close;

_quartoOcupado:
	mes "[Seu Agirrab]";
	mes "\"O quarto nº"+@QuartosSelecionado+" já está alugado para "+$PB_Inquilinos$[@QuartosSelecionado]+".";
	mes "Por favor escolha um quarto vago ou de locação vencida!\"";
	next;
	goto _PreLocatarios;

_quartoAlugar:
	if(zeny < @PB_Custo) goto _sem_grana;
	set zeny, zeny - @PB_Custo;
	set $PB_Inquilinos$[@QuartosSelecionado], strcharinfo(0);
	set $PB_Senha$[@QuartosSelecionado], "";
	set $PB_Vencimentos[@QuartosSelecionado], gettimetick(2) + @SegAlugados;
	mes "[Seu Agirrab]";
	mes "\"Pode se dirigir ao quarto nº"+ @QuartosSelecionado +" que ele ja foi desbloqueado para você!\"";
	next;
	mes "[Seu Agirrab]";
	mes "\"Você pode trocar a senha do quarto pelo lado de dentro!\"";
	next;
	mes "["+ strcharinfo(0) +"]";
	mes "Obrigado!";
	close;

_sem_grana:
	mes "[Seu Agirrab]";
	mes "\"Você não tem a grana necessária para isso!\"";
	close;

_ResetPB:
// Resetando as variáveis no primeiro uso do NPC, pois o tempo antes não era contado corretamente(os quer alugavam uma vez, alugavam para sempre).
	setarray $PB_Inquilinos$, 
	"", "", "", "", "", "", "", "", "", "", 
	"", "", "", "", "", "", "", "", "", "", 
	"", "", "", "", "", "", "", "", "", "";
	setarray $PB_Senha$, 
	"", "", "", "", "", "", "", "", "", "", 
	"", "", "", "", "", "", "", "", "", "", 
	"", "", "", "", "", "", "", "", "", "";
	setarray $PB_Vencimentos, 
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
	set $RESET_PB, 1;
	goto _inicio;

_TempoLocacao:
	set @t, 0;
	
_LoopTempo:
	if (@t > 29) goto _MostraLocatarios;
	if ($PB_Vencimentos[@t] != 0 && $PB_Vencimentos[@t] < gettimetick(2)) set $PB_Inquilinos$[@t], "";
	if ($PB_Vencimentos[@t] != 0 && $PB_Vencimentos[@t] < gettimetick(2)) set $PB_Vencimentos[@t], 0;
	set @t, @t + 1;
	goto _LoopTempo;

}
