// NPC que controla quem matou os totems

// Variáveis:

// Não Globais temporárias:
// @loop - Usada quando é necessário passar pelos elementos de uma array(array[@loop], onde @loop é acrescido de +1 até o fim da array)

// Globais Temporárias:
// $@Loop - A mesma função de @loop, mas nos contextos em que não há um RID atachado à execução do script
// $@Evento_Status - 0 = desabilitado, 1 = habilitado, 2 = Fase de anúncios
// $@Evento_Debug - 0 = Debug desabilitado 1 = Debug habilitado
// $@Evento_Inicio - Momento em que se inicia o evento (Unix timestamp)
// $@Anuncios - Variável de controle para definir quais textos serão exibidos durante o período de anúncios.
// $@Grupos_AutoEvento$ - Lista com o nome dos grupos participantes
// $@Pilares_Donos - Array contendo o número dos atuais "donos" dos Pilares
// $@Mortes_Evento_Pilares - Array contendo a quantidade de mortes em PVP conseguidas por cada grupo
// $@Grupo1$, $@Grupo2$, etc - Nome de cada grupo
// $@Grupo1_Pilares, $@Grupo2_Pilares, etc - Quantidade de Pilares derrubados por cada grupo.
// $@Vencedor_Pilares - Quantidade de Pilares derrubados pelo grupo vencedor
// $@Vencedor_Mortes - Número de mortes conseguidas pelo grupo mais eficiente no PVP

// Não globais Permanentes:
// ControleDeEventos - ID global do evento atual($Controle_Eventos) no âmbito do jogador, para controlar quando ele pode resgatar o prêmio.
// grupoexistente - Número do grupo em que o jogador foi inserido.

// Globais Permanentes:
// $Controle_Eventos - Uma espécie de ID única de cada evento. A cada evento esta variável é acrescida em +1.
// $Vencedor_Mortes_Grupo - Número do grupo mais eficiente no quesito PVP entre os empatados no quesito "Derrubada de pilar"
// $Empatados - Array com os grupos empatados no quesito "derrubada de Pilares"
// $Empatados_Mortes - Array com o número dos grupos empatados nos quesitos "derrubada de Pilares" E "morte em pvp"
// $Vencedor_Grupo - Número do grupo vencedor

002.gat,107,115,0	script	#Controle	45,{

    end;

L_Iniciar:
    monster "002.gat", 93, 105, "", 1014, 1, "#Controle::OnPilar1Death";
    monster "002.gat", 93, 100, "", 1014, 1, "#Controle::OnPilar2Death";
    monster "002.gat", 93, 95, "", 1014, 1, "#Controle::OnPilar3Death";
    monster "002.gat", 93, 90, "", 1014, 1, "#Controle::OnPilar4Death";
    monster "002.gat", 93, 85, "", 1014, 1, "#Controle::OnPilar5Death";
    monster "002.gat", 105, 105, "", 1014, 1, "#Controle::OnPilar6Death";
    monster "002.gat", 105, 100, "", 1014, 1, "#Controle::OnPilar7Death";
    monster "002.gat", 105, 95, "", 1014, 1, "#Controle::OnPilar8Death";
    monster "002.gat", 105, 90, "", 1014, 1, "#Controle::OnPilar9Death";
    monster "002.gat", 105, 85, "", 1014, 1, "#Controle::OnPilar10Death";
    monster "002.gat", 101, 85, "", 1014, 1, "#Controle::OnPilar11Death";
    monster "002.gat", 97, 85, "", 1014, 1, "#Controle::OnPilar12Death";
    set $@Evento_Status, 1;
    // A variável $@Evento_Debug só tem uso durante os testes. Depois vou eliminá-la.
    set $@Evento_Debug, 1;
    set $@Evento_Inicio, gettimetick(2);
    set $Controle_Eventos, $Controle_Eventos + 1;
    // Limpando os dados relativos aos vencedores do último evento
    set $@Vencedor_Pilares, 0;
    set $Vencedor_Grupo, 0;
    set $@Vencedor_Mortes, 0;
    set $Vencedor_Mortes_Grupo, 0;
    cleararray $Empatados_Mortes[0], 0, 13;
    cleararray $Empatados[0], 0, 13;
    end;

OnTimer5000:
    setnpctimer 0;
    // Modo Normal - Utiliza a data atual
    //if (gettime(4) != 6 || gettime(3) < 18)
        //end;
    //if (gettime(3) > 20 && $@Evento_Status == 1)
        //goto L_Limpar;
    //if (gettime(3) == 18 || (gettime(3) == 19 && gettime(2) == 0))
        //goto L_Anuncios;

    //Modo Debug - Habilitado Manualmente
    if ($@Evento_Status == 0 && $@Evento_Debug == 1)
        goto L_Iniciar;
    if ($@Evento_Status == 1 && $@Evento_Debug == 0)
        goto L_Limpar;
    if ($@Evento_Status == 1)
        goto L_Checar_Tempo;
    if ($@Evento_Status == 0 && $@Evento_Debug == 2)
        goto L_Anuncios;
    end;

OnPilar1Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[1] != @loop)
        announce "O Pilar de Aries foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[1] != @loop)
        set $@Pilares_Donos[1], @loop;
    monster "002.gat", 93, 105, "", 1014, 1, "#Controle::OnPilar1Death";
    end;

OnPilar2Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[2] != @loop)
        announce "O Pilar de Touro foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[2] != @loop)
        set $@Pilares_Donos[2], @loop;
    monster "002.gat", 93, 100, "", 1014, 1, "#Controle::OnPilar2Death";
    end;

OnPilar3Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[3] != @loop)
        announce "O Pilar de Gêmeos foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[3] != @loop)
        set $@Pilares_Donos[3], @loop;
    monster "002.gat", 93, 95, "", 1014, 1, "#Controle::OnPilar3Death";
    end;

OnPilar4Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[4] != @loop)
        announce "O Pilar de Câncer foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[4] != @loop)
        set $@Pilares_Donos[4], @loop;
    monster "002.gat", 93, 90, "", 1014, 1, "#Controle::OnPilar4Death";
    end;

OnPilar5Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[5] != @loop)
        announce "O Pilar de Leão foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[5] != @loop)
        set $@Pilares_Donos[5], @loop;
    monster "002.gat", 93, 85, "", 1014, 1, "#Controle::OnPilar5Death";
    end;

OnPilar6Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[6] != @loop)
        announce "O Pilar de Virgem foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[6] != @loop)
        set $@Pilares_Donos[6], @loop;
    monster "002.gat", 105, 105, "", 1014, 1, "#Controle::OnPilar6Death";
    end;

OnPilar7Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[7] != @loop)
        announce "O Pilar de Libra foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[7] != @loop)
        set $@Pilares_Donos[7], @loop;
    monster "002.gat", 105, 100, "", 1014, 1, "#Controle::OnPilar7Death";
    end;

OnPilar8Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[8] != @loop)
        announce "O Pilar de Escorpião foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[8] != @loop)
        set $@Pilares_Donos[8], @loop;
    monster "002.gat", 105, 95, "", 1014, 1, "#Controle::OnPilar8Death";
    end;

OnPilar9Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[9] != @loop)
        announce "O Pilar de Sagitário foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[9] != @loop)
        set $@Pilares_Donos[9], @loop;
    monster "002.gat", 105, 90, "", 1014, 1, "#Controle::OnPilar9Death";
    end;

OnPilar10Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[10] != @loop)
        announce "O Pilar de Capricórnio foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[10] != @loop)
        set $@Pilares_Donos[10], @loop;
    monster "002.gat", 105, 85, "", 1014, 1, "#Controle::OnPilar10Death";
    end;

OnPilar11Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[11] != @loop)
        announce "O Pilar de Aquário foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[11] != @loop)
        set $@Pilares_Donos[11], @loop;
    monster "002.gat", 101, 85, "", 1014, 1, "#Controle::OnPilar11Death";
    end;

OnPilar12Death:
    set @loop, 0;
    callsub S_QualGrupo;
    if ($@Pilares_Donos[12] != @loop)
        announce "O Pilar de Peixes foi derrubado pela família " + getpartyname(getcharid(1)), 0;
    if ($@Pilares_Donos[12] != @loop)
        set $@Pilares_Donos[12], @loop;
    monster "002.gat", 97, 85, "", 1014, 1, "#Controle::OnPilar12Death";
    end;

L_Anuncios:
//    Valores apenas para teste
    if (gettime(1) >= 10 && gettime(1) <= 20 && $@Anuncios == 0)
        goto L_Anuncio1;
    if (gettime(1) >= 20 && gettime(1) <= 30 && $@Anuncios == 1)
        goto L_Anuncio2;
    if (gettime(1) >= 30 && gettime(1) <= 40 && $@Anuncios == 2)
        goto L_Anuncio3;
    if (gettime(1) >= 40 && gettime(1) <= 50 && $@Anuncios == 3)
        goto L_Anuncio4;
    if (gettime(1) >= 50 && gettime(1) <= 59 && $@Anuncios == 4)
        goto L_Anuncio5;
    if (gettime(1) >= 0 && gettime(1) <= 10 && $@Anuncios == 5)
        goto L_Anuncio6;
    end;

L_Anuncio1:
    announce "Os Pilares de Érnegon sustentam o Mundo de Mana desde tempos imemoriais... Recentemente, passaram a sofrer instabilidades, devido ao alinhamento galáctico. Forças universais estão abaladas e poderosos Alquimistas acreditam que isto perdurará por mil anos.", 0;
    set $@Anuncios, 1;
    end;

L_Anuncio2:
    announce "Desde eras mitológicas até esses últimos dias, os Pilares de Érnegon permaneceram ocultos na região do Castelo Brhamir. Garantindo a todos os povos o equilíbrio necessário para sustentar toda a existência com paz.", 0;
    set $@Anuncios, 2;
    end;

L_Anuncio3:
    announce "Com o tempo das trevas a energia mana dos Pilares de Érnegon foi quase esgotada. A quantidade de mana que restou já não é suficiente para manter a invisibilidade e defesa dos Pilares. Estão vulneráveis no Jardim do Castelo e sofrendo ataques do submundo. Será este o fim?", 0;
    set $@Anuncios, 3;
    end;

L_Anuncio4:
    announce "Existem segredos milenares guardados exclusivamente no Reino de Lilith: 'Reza a lenda que os Pilares de Érnegon quando fracos precisam ser destruídos por irmãos de uma Família', somente assim os Pilares serão renovados.", 0;
    set $@Anuncios, 4;
    end;

L_Anuncio5:
    announce "Generais Mágicos e Alquimistas unem esforços para despertar o Mestre dos Magos, Danboudor! Ele é sábio e poderoso para aperfeiçoar com magia e conhecimento as Famílias. Caso consigam, Danboudor aparecerá por pouco tempo no Portão do Castelo...", 0;
    set $@Anuncios, 5;
    end;

L_Anuncio6:
    announce "A batalha pela vida e perpetuação das raças é trágica e violenta... O odor de sangue pode ser sentido desde a entrada da Vila! Apenas uma Família sairá vitoriosa... Ao ataque cavaleiros e amazonas, pouco tempo nos resta!!!", 0;
    set $@Anuncios, 0;
    goto L_Iniciar;

L_Checar_Tempo:
    // Aqui é definido o tempo do evento em segundos. Estou utilizando 30 apenas para facilitar os testes.
    if (gettimetick(2) - $@Evento_Inicio > 30)
        goto L_Fim_Evento;
    end;

OnPCKilledEvent:
    if ($@Evento_Status != 1)
        end;
    attachrid(@killerrid);
    if (ControleDeEventos == $Controle_Eventos && $Controle_Eventos != 0 && grupoexistente != 0)
        goto L_Matou;
    end;

L_Matou:
    announce strcharinfo(0) + " derrotou um adversário no campo de batalha.", 0;
    message strcharinfo(0), "Aê! Você derrotou alguém!";
    percentheal -100, 0;
    // Registra uma vitória em PVP para o grupo da pessoa. Isto é considerado como critério de desempate no fim.
    set $@Mortes_Evento_Pilares[grupoexistente], $@Mortes_Evento_Pilares[grupoexistente] + 1;
    end;

L_Fim_Evento:
    set $@Loop, 0;
    callsub S_Contagem;
    set $@Loop, 0;
    set $Vencedor_Grupo, 0;
    set $@Vencedor_Pilares, 0;
    set $@Vencedor_Mortes, 0;
    callsub S_Compara;
    callsub S_Repetidos;
    callsub S_Desempate;
    set $@Loop, 0;
    callsub S_Desempate_Repetidos;
    if ($@Vencedor_Pilares != 0 && getarraysize($Empatados) == 1)
        announce "A família " + $@Grupos_AutoEvento$[$Vencedor_Grupo] + " capturou " + $@Vencedor_Pilares + " Pilares e ganhou o evento!", 0;
    if ($@Vencedor_Pilares == 0)
        announce "Nenhum Pilar foi derrubado. Ninguém ganhou. :D", 0;
    if ($@Vencedor_Pilares != 0 && getarraysize($Empatados) != 1)
        goto L_Anuncia_Empate_Simples;
    goto L_Limpar;

L_Anuncia_Empate_Simples:
    if (getarraysize($Empatados_Mortes) != 1 && $@Vencedor_Mortes != 0)
        goto L_Anuncia_Empate_Mortes;
    if (getarraysize($Empatados_Mortes) == 1 && $@Vencedor_Mortes != 0)
        goto L_Anuncia_Vencedor_Mortes;
    announce "Os vencedores foram as seguintes famílias, que derrubaram " + $@Vencedor_Pilares + " totens cada uma: ", 0;
    announce "Família " + $@Grupos_AutoEvento$[$Vencedor_Grupo], 0;
    if ($Empatados[1] != 0)
        announce "Família " + $@Grupos_AutoEvento$[1], 0;
    if ($Empatados[2] != 0)
        announce "Família " + $@Grupos_AutoEvento$[2], 0;
    if ($Empatados[3] != 0)
        announce "Família " + $@Grupos_AutoEvento$[3], 0;
    if ($Empatados[4] != 0)
        announce "Família " + $@Grupos_AutoEvento$[4], 0;
    if ($Empatados[5] != 0)
        announce "Família " + $@Grupos_AutoEvento$[5], 0;
    if ($Empatados[6] != 0)
        announce "Família " + $@Grupos_AutoEvento$[6], 0;
    if ($Empatados[7] != 0)
        announce "Família " + $@Grupos_AutoEvento$[7], 0;
    if ($Empatados[8] != 0)
        announce "Família " + $@Grupos_AutoEvento$[8], 0;
    if ($Empatados[9] != 0)
        announce "Família " + $@Grupos_AutoEvento$[9], 0;
    if ($Empatados[10] != 0)
        announce "Família " + $@Grupos_AutoEvento$[10], 0;
    if ($Empatados[11] != 0)
        announce "Família " + $@Grupos_AutoEvento$[11], 0;
    if ($Empatados[12] != 0)
        announce "Família " + $@Grupos_AutoEvento$[12], 0;
    goto L_Limpar;

L_Anuncia_Empate_Mortes:
    announce "Os vencedores foram as seguintes famílias, que derrubaram " + $@Vencedor_Pilares + " totens e derrotaram " + $@Vencedor_Mortes + " inimigos cada uma: ", 0;
    if ($@Mortes_Evento_Pilares[1] == $@Vencedor_Mortes && $@Grupo1_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[1], 0;
    if ($@Mortes_Evento_Pilares[2] == $@Vencedor_Mortes && $@Grupo2_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[2], 0;
    if ($@Mortes_Evento_Pilares[3] == $@Vencedor_Mortes && $@Grupo3_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[3], 0;
    if ($@Mortes_Evento_Pilares[4] == $@Vencedor_Mortes && $@Grupo4_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[4], 0;
    if ($@Mortes_Evento_Pilares[5] == $@Vencedor_Mortes && $@Grupo5_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[5], 0;
    if ($@Mortes_Evento_Pilares[6] == $@Vencedor_Mortes && $@Grupo6_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[6], 0;
    if ($@Mortes_Evento_Pilares[7] == $@Vencedor_Mortes && $@Grupo7_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[7], 0;
    if ($@Mortes_Evento_Pilares[8] == $@Vencedor_Mortes && $@Grupo8_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[8], 0;
    if ($@Mortes_Evento_Pilares[9] == $@Vencedor_Mortes && $@Grupo9_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[9], 0;
    if ($@Mortes_Evento_Pilares[10] == $@Vencedor_Mortes && $@Grupo10_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[10], 0;
    if ($@Mortes_Evento_Pilares[11] == $@Vencedor_Mortes && $@Grupo11_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[11], 0;
    if ($@Mortes_Evento_Pilares[12] == $@Vencedor_Mortes && $@Grupo11_Pilares == $@Vencedor_Pilares)
        announce "Família " + $@Grupos_AutoEvento$[12], 0;
    goto L_Limpar;

L_Anuncia_Vencedor_Mortes:
    announce "A família " + $@Grupos_AutoEvento$[$@Vencedor_Mortes] + " derrubou " + $@Vencedor_Pilares + " Pilares e derrotou " + $@Vencedor_Mortes + " adversários, o que faz dela a vencedora do evento.", 0;
    goto L_Limpar;

S_QualGrupo:
    set @loop, @loop + 1;
    if ($@Grupos_AutoEvento$[@loop] == getpartyname(getcharid(1)))
        return;
    if (@loop > 12)
        message strcharinfo(0), "nao achei seu grupo!";
    if (@loop > 12)
        return;
    goto S_QualGrupo;

S_Contagem:
    set $@Loop, $@Loop + 1;
    if ($@Loop > 12) return;
    if ($@Pilares_Donos[$@Loop] == 1)
        set $@Grupo1_Pilares, $@Grupo1_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 2)
        set $@Grupo2_Pilares, $@Grupo2_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 3)
        set $@Grupo3_Pilares, $@Grupo3_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 4)
        set $@Grupo4_Pilares, $@Grupo4_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 5)
        set $@Grupo5_Pilares, $@Grupo5_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 6)
        set $@Grupo6_Pilares, $@Grupo6_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 7)
        set $@Grupo7_Pilares, $@Grupo7_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 8)
        set $@Grupo8_Pilares, $@Grupo8_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 9)
        set $@Grupo9_Pilares, $@Grupo9_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 10)
        set $@Grupo10_Pilares, $@Grupo10_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 11)
        set $@Grupo11_Pilares, $@Grupo11_Pilares + 1;
    if ($@Pilares_Donos[$@Loop] == 12)
        set $@Grupo12_Pilares, $@Grupo12_Pilares + 1;
    goto S_Contagem;

S_Compara:
    if ($@Grupo1_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,1;
    if ($@Grupo1_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo1_Pilares;
    if ($@Grupo2_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,2;
    if ($@Grupo2_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo2_Pilares;
    if ($@Grupo3_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,3;
    if ($@Grupo3_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo3_Pilares;
    if ($@Grupo4_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,4;
    if ($@Grupo4_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo4_Pilares;
    if ($@Grupo5_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,5;
    if ($@Grupo5_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo5_Pilares;
    if ($@Grupo6_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,6;
    if ($@Grupo6_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo6_Pilares;
    if ($@Grupo7_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,7;
    if ($@Grupo7_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo7_Pilares;
    if ($@Grupo8_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,8;
    if ($@Grupo8_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo8_Pilares;
    if ($@Grupo9_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,9;
    if ($@Grupo9_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo9_Pilares;
    if ($@Grupo10_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,10;
    if ($@Grupo10_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo10_Pilares;
    if ($@Grupo11_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,11;
    if ($@Grupo11_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo11_Pilares;
    if ($@Grupo12_Pilares > $@Vencedor_Pilares)
        set $Vencedor_Grupo,12;
    if ($@Grupo12_Pilares > $@Vencedor_Pilares)
        set $@Vencedor_Pilares, $@Grupo12_Pilares;
    return;

S_Repetidos:
    if ($@Vencedor_Pilares == 0)
        return;
    if ($Vencedor_Grupo != 1 && $@Grupo1_Pilares == $@Vencedor_Pilares)
        set $Empatados[1], 1;
    if ($Vencedor_Grupo != 2 && $@Grupo2_Pilares == $@Vencedor_Pilares)
        set $Empatados[2], 2;
    if ($Vencedor_Grupo != 3 && $@Grupo3_Pilares == $@Vencedor_Pilares)
        set $Empatados[3], 3;
    if ($Vencedor_Grupo != 4 && $@Grupo4_Pilares == $@Vencedor_Pilares)
        set $Empatados[4], 4;
    if ($Vencedor_Grupo != 5 && $@Grupo5_Pilares == $@Vencedor_Pilares)
        set $Empatados[5], 5;
    if ($Vencedor_Grupo != 6 && $@Grupo6_Pilares == $@Vencedor_Pilares)
        set $Empatados[6], 6;
    if ($Vencedor_Grupo != 7 && $@Grupo7_Pilares == $@Vencedor_Pilares)
        set $Empatados[7], 7;
    if ($Vencedor_Grupo != 8 && $@Grupo8_Pilares == $@Vencedor_Pilares)
        set $Empatados[8], 8;
    if ($Vencedor_Grupo != 9 && $@Grupo9_Pilares == $@Vencedor_Pilares)
        set $Empatados[9], 9;
    if ($Vencedor_Grupo != 10 && $@Grupo10_Pilares == $@Vencedor_Pilares)
        set $Empatados[10], 10;
    if ($Vencedor_Grupo != 11 && $@Grupo11_Pilares == $@Vencedor_Pilares)
        set $Empatados[11], 11;
    if ($Vencedor_Grupo != 12 && $@Grupo12_Pilares == $@Vencedor_Pilares)
        set $Empatados[12], 12;
    return;

S_Desempate:
    if (getarraysize($Empatados) == 1)
        return;
    if ($@Mortes_Evento_Pilares[1] > $@Vencedor_Mortes && $Empatados[1] != 0)
        set $Vencedor_Mortes_Grupo, 1;
    if ($@Mortes_Evento_Pilares[1] > $@Vencedor_Mortes && $Empatados[1] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[1];
    if ($@Mortes_Evento_Pilares[2] > $@Vencedor_Mortes && $Empatados[2] != 0)
        set $Vencedor_Mortes_Grupo, 2;
    if ($@Mortes_Evento_Pilares[2] > $@Vencedor_Mortes && $Empatados[2] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[2];
    if ($@Mortes_Evento_Pilares[3] > $@Vencedor_Mortes && $Empatados[3] != 0)
        set $Vencedor_Mortes_Grupo, 3;
    if ($@Mortes_Evento_Pilares[3] > $@Vencedor_Mortes && $Empatados[3] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[3];
    if ($@Mortes_Evento_Pilares[4] > $@Vencedor_Mortes && $Empatados[4] != 0)
        set $Vencedor_Mortes_Grupo, 4;
    if ($@Mortes_Evento_Pilares[4] > $@Vencedor_Mortes && $Empatados[4] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[4];
    if ($@Mortes_Evento_Pilares[5] > $@Vencedor_Mortes && $Empatados[5] != 0)
        set $Vencedor_Mortes_Grupo, 5;
    if ($@Mortes_Evento_Pilares[5] > $@Vencedor_Mortes && $Empatados[5] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[5];
    if ($@Mortes_Evento_Pilares[6] > $@Vencedor_Mortes && $Empatados[6] != 0)
        set $Vencedor_Mortes_Grupo, 6;
    if ($@Mortes_Evento_Pilares[6] > $@Vencedor_Mortes && $Empatados[6] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[6];
    if ($@Mortes_Evento_Pilares[7] > $@Vencedor_Mortes && $Empatados[7] != 0)
        set $Vencedor_Mortes_Grupo, 7;
    if ($@Mortes_Evento_Pilares[7] > $@Vencedor_Mortes && $Empatados[7] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[7];
    if ($@Mortes_Evento_Pilares[8] > $@Vencedor_Mortes && $Empatados[8] != 0)
        set $Vencedor_Mortes_Grupo, 8;
    if ($@Mortes_Evento_Pilares[8] > $@Vencedor_Mortes && $Empatados[8] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[8];
    if ($@Mortes_Evento_Pilares[9] > $@Vencedor_Mortes && $Empatados[9] != 0)
        set $Vencedor_Mortes_Grupo, 9;
    if ($@Mortes_Evento_Pilares[9] > $@Vencedor_Mortes && $Empatados[9] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[9];
    if ($@Mortes_Evento_Pilares[10] > $@Vencedor_Mortes && $Empatados[10] != 0)
        set $Vencedor_Mortes_Grupo, 10;
    if ($@Mortes_Evento_Pilares[10] > $@Vencedor_Mortes && $Empatados[10] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[10];
    if ($@Mortes_Evento_Pilares[11] > $@Vencedor_Mortes && $Empatados[11] != 0)
        set $Vencedor_Mortes_Grupo, 11;
    if ($@Mortes_Evento_Pilares[11] > $@Vencedor_Mortes && $Empatados[11] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[11];
    if ($@Mortes_Evento_Pilares[12] > $@Vencedor_Mortes && $Empatados[12] != 0)
        set $Vencedor_Mortes_Grupo, 12;
    if ($@Mortes_Evento_Pilares[12] > $@Vencedor_Mortes && $Empatados[12] != 0)
        set $@Vencedor_Mortes, $@Mortes_Evento_Pilares[12];
    return;

S_Desempate_Repetidos:
    if ($@Vencedor_Mortes == 0) return;
    if ($Vencedor_Mortes_Grupo != 1 && $@Mortes_Evento_Pilares[1] == $@Vencedor_Mortes)
        set $Empatados_Mortes[1], 1;
    if ($Vencedor_Mortes_Grupo != 2 && $@Mortes_Evento_Pilares[2] == $@Vencedor_Mortes)
        set $Empatados_Mortes[2], 2;
    if ($Vencedor_Mortes_Grupo != 3 && $@Mortes_Evento_Pilares[3] == $@Vencedor_Mortes)
        set $Empatados_Mortes[3], 3;
    if ($Vencedor_Mortes_Grupo != 4 && $@Mortes_Evento_Pilares[4] == $@Vencedor_Mortes)
        set $Empatados_Mortes[4], 4;
    if ($Vencedor_Mortes_Grupo != 5 && $@Mortes_Evento_Pilares[5] == $@Vencedor_Mortes)
        set $Empatados_Mortes[5], 5;
    if ($Vencedor_Mortes_Grupo != 6 && $@Mortes_Evento_Pilares[6] == $@Vencedor_Mortes)
        set $Empatados_Mortes[6], 6;
    if ($Vencedor_Mortes_Grupo != 7 && $@Mortes_Evento_Pilares[7] == $@Vencedor_Mortes)
        set $Empatados_Mortes[7], 7;
    if ($Vencedor_Mortes_Grupo != 8 && $@Mortes_Evento_Pilares[8] == $@Vencedor_Mortes)
        set $Empatados_Mortes[8], 8;
    if ($Vencedor_Mortes_Grupo != 9 && $@Mortes_Evento_Pilares[9] == $@Vencedor_Mortes)
        set $Empatados_Mortes[9], 9;
    if ($Vencedor_Mortes_Grupo != 10 && $@Mortes_Evento_Pilares[10] == $@Vencedor_Mortes)
        set $Empatados_Mortes[10], 10;
    if ($Vencedor_Mortes_Grupo != 11 && $@Mortes_Evento_Pilares[11] == $@Vencedor_Mortes)
        set $Empatados_Mortes[11], 11;
    if ($Vencedor_Mortes_Grupo != 12 && $@Mortes_Evento_Pilares[12] == $@Vencedor_Mortes)
        set $Empatados_Mortes[12], 12;
    return;

L_Limpar:
    set $@Evento_Status, 0;
    set $@Evento_Debug, 0;
    set $@Evento_Inicio, 0;
    cleararray $@Grupos_AutoEvento$[0], "", 13;
    cleararray $@Grupo1$[0], "", 13;
    cleararray $@Grupo2$[0], "", 13;
    cleararray $@Grupo3$[0], "", 13;
    cleararray $@Grupo4$[0], "", 13;
    cleararray $@Grupo5$[0], "", 13;
    cleararray $@Grupo6$[0], "", 13;
    cleararray $@Grupo7$[0], "", 13;
    cleararray $@Grupo8$[0], "", 13;
    cleararray $@Grupo9$[0], "", 13;
    cleararray $@Grupo10$[0], "", 13;
    cleararray $@Grupo11$[0], "", 13;
    cleararray $@Grupo12$[0], "", 13;
    cleararray $@Mortes_Evento_Pilares[0], 0, 13;
    set $@Grupo1_Pilares, 0;
    set $@Grupo2_Pilares, 0;
    set $@Grupo3_Pilares, 0;
    set $@Grupo4_Pilares, 0;
    set $@Grupo5_Pilares, 0;
    set $@Grupo6_Pilares, 0;
    set $@Grupo7_Pilares, 0;
    set $@Grupo8_Pilares, 0;
    set $@Grupo9_Pilares, 0;
    set $@Grupo10_Pilares, 0;
    set $@Grupo11_Pilares, 0;
    set $@Grupo12_Pilares, 0;
    cleararray $@Pilares_Donos[0], 0, 13;
    killmonster "002.gat", "#Controle::OnPilar1Death";
    killmonster "002.gat", "#Controle::OnPilar2Death";
    killmonster "002.gat", "#Controle::OnPilar3Death";
    killmonster "002.gat", "#Controle::OnPilar4Death";
    killmonster "002.gat", "#Controle::OnPilar5Death";
    killmonster "002.gat", "#Controle::OnPilar6Death";
    killmonster "002.gat", "#Controle::OnPilar7Death";
    killmonster "002.gat", "#Controle::OnPilar8Death";
    killmonster "002.gat", "#Controle::OnPilar9Death";
    killmonster "002.gat", "#Controle::OnPilar10Death";
    killmonster "002.gat", "#Controle::OnPilar11Death";
    killmonster "002.gat", "#Controle::OnPilar12Death";
    end;

onInit:
    // O timer roda permanentemente. A partir dele vai ser checado quando vai iniciar o evento (sábado, 16:00?)
    initnpctimer;
    end;

}
