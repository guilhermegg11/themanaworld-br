/**
 * Funções para o evento de Páscoa 2011
 */

/**
 * Um esconderijo genérico para ovos de páscoa.
 *
 * @var arg0 Nome do mapa.
 * @var arg1 coordenada x do NPC.
 * @var arg2 coordenada y do NPC.
 * @var arg3 Nome do NPC. ponte, planta, flor...
 * @var @num Identificador numérico do esconderijo.
 * @date quinta, 03 de março de 2011
 * @author Diogo_RBG - http://diogorbg.blogspot.com
 */
function	script	escondeOvos	{
	set @ovoPascoa,      1208;
	set @ovoPascoaPrata, 3225;

	set @x, getarg(1);
	set @y, getarg(2);
	if( isin(getarg(0), @x-3, @y-3, @x+3, @y+3)==0 ) goto _longe;

	if(PASCOA2_esconde==0) goto _explicaJogo;
	if(PASCOA2_esconde!=2 && PASCOA2_esconde!=5 && PASCOA2_esconde!=9) goto _naoEncontrarOvo;
	if(PASCOA2_esconde==11) goto _fimJogo;

	if(PASCOA2_esconde==2 && PASCOA2_escondeNum%12==@num%12) goto _encontrarOvo;
	if(PASCOA2_esconde==5) goto _escondendoOvos;
	if(PASCOA2_esconde==9) goto _procurandoOvosPrata;
	goto _naoEncontrarOvo;

//- Procurando ovos de páscoa ------------------------------------------

_naoEncontrarOvo:
	mes "[Esconderijo]";
	if(getarg(3)=="pedra") mes "Nenhum ovo de páscoa escondido atrás desta pedra.";
	if(getarg(3)=="placa") mes "Nenhum ovo de páscoa escondido atrás desta placa.";
	if(getarg(3)=="pilha de madeira") mes "Nenhum ovo de páscoa escondido atrás desta pilha de madeira.";
	if(getarg(3)=="poste de luz") mes "Nenhum ovo de páscoa escondido atrás deste poste de luz.";
	if(getarg(3)=="planta") mes "Nenhum ovo de páscoa escondido nas folhas desta planta.";
	if(getarg(3)=="palmeira") mes "Nenhum ovo de páscoa escondido na copa desta palmeira.";
	if(getarg(3)=="árvore      ") mes "Nenhum ovo de páscoa escondido no tronco oco desta árvore.";
	if(getarg(3)=="flor") mes "Nenhum ovo de páscoa escondido no meio destas flores.";
	if(getarg(3)=="ponte") mes "Nenhum ovo de páscoa escondido debaixo desta ponte.";
	if(getarg(3)=="caverna") mes "Nenhum ovo de páscoa escondido na entrada desta caverna.";
	if(getarg(3)=="cerca") mes "Nenhum ovo de páscoa escondido atrás desta cerca.";
	if(getarg(3)=="bueiro") mes "Nenhum ovo de páscoa escondido dentro deste bueiro.";
	if(getarg(3)=="vaso") mes "Nenhum ovo de páscoa escondido dentro deste vaso.";
	if(getarg(3)=="barril") mes "Nenhum ovo de páscoa escondido dentro deste barril.";
	if(getarg(3)=="trigo") mes "Nenhum ovo de páscoa escondido dentro deste trigo.";
	if(getarg(3)=="cactus") mes "Nenhum ovo de páscoa escondido entre os espinhos deste cactus.";
	if(getarg(3)=="ninho") mes "Nenhum ovo de páscoa escondido entre os ovos deste ninho.";
	if(getarg(3)=="monte de terra") mes "Nenhum ovo de páscoa enterrado neste monte de terra.";
	return;

_encontrarOvo:
	mes "[Esconderijo]";
	mes "Agora sim!";
	mes "";
	if(getarg(3)=="pedra") mes "* Você encontrou um ovo de páscoa escondido atrás desta pedra.";
	if(getarg(3)=="placa") mes "* Você encontrou um ovo de páscoa escondido atrás desta placa.";
	if(getarg(3)=="pilha de madeira") mes "* Você encontrou um ovo de páscoa escondido atrás desta pilha de madeira.";
	if(getarg(3)=="poste de luz") mes "* Você encontrou um ovo de páscoa escondido atrás deste poste de luz.";
	if(getarg(3)=="planta") mes "* Você encontrou um ovo de páscoa escondido nas folhas desta planta.";
	if(getarg(3)=="palmeira") mes "* Você encontrou um ovo de páscoa escondido na copa desta palmeira.";
	if(getarg(3)=="árvore      ") mes "* Você encontrou um ovo de páscoa escondido no tronco oco desta árvore.";
	if(getarg(3)=="flor") mes "* Você encontrou um ovo de páscoa escondido no meio destas flores.";
	if(getarg(3)=="ponte") mes "* Você encontrou um ovo de páscoa escondido debaixo desta ponte.";
	if(getarg(3)=="caverna") mes "* Você encontrou um ovo de páscoa escondido na entrada desta caverna.";
	if(getarg(3)=="cerca") mes "* Você encontrou um ovo de páscoa escondido atrás desta cerca.";
	if(getarg(3)=="bueiro") mes "* Você encontrou um ovo de páscoa escondido dentro deste bueiro.";
	if(getarg(3)=="vaso") mes "* Você encontrou um ovo de páscoa escondido dentro deste vaso.";
	if(getarg(3)=="barril") mes "* Você encontrou um ovo de páscoa escondido dentro deste barril.";
	if(getarg(3)=="trigo") mes "* Você encontrou um ovo de páscoa escondido dentro deste trigo.";
	if(getarg(3)=="cactus") mes "* Você encontrou um ovo de páscoa escondido entre os espinhos deste cactus.";
	if(getarg(3)=="ninho") mes "* Você encontrou um ovo de páscoa escondido entre os ovos deste ninho.";
	if(getarg(3)=="monte de terra") mes "* Você encontrou um ovo de páscoa enterrado neste monte de terra.";
	getitem @ovoPascoa+rand(6), 1;
	set @escondeNum, rand(12); //- ovos normais do desafio3.
	if(PASCOA2_esconde!=2) return;
	set PASCOA2_escondeNum, rand(12); //- 8,33% de chance... 2 ovos no mapa 012
	set PASCOA2_escondeCont, PASCOA2_escondeCont+1;
	message strcharinfo(0), "Já encontrei " +PASCOA2_escondeCont+ "/10 ovos de páscoa.";
	return;

//- Escondendo ovos de páscoa ------------------------------------------

_escondendoOvos:
	set @ovo, -1;
	if( countitem(@ovoPascoa+0)>=1 ) set @ovo, 0;
	if( countitem(@ovoPascoa+1)>=1 ) set @ovo, 1;
	if( countitem(@ovoPascoa+2)>=1 ) set @ovo, 2;
	if( countitem(@ovoPascoa+3)>=1 ) set @ovo, 3;
	if( countitem(@ovoPascoa+4)>=1 ) set @ovo, 4;
	if( countitem(@ovoPascoa+5)>=1 ) set @ovo, 5;
	if(@ovo<0) goto _semOvo;
	if(PASCOA2_escondeNum%6==@num%6) goto _esconderOvo;
	goto _naoEsconderOvo;

_semOvo:
	mes "[Esconderijo]";
	mes "Você não tem um ovo de páscoa para esconder.";
	mes "Fale com o Coelho para conseguir um.";
	return;

_naoEsconderOvo:
	mes "[Esconderijo]";
	if(@num%2==0) mes "Este não parece ser um bom local para esconder seu ovo de páscoa.";
	if(@num%2==1) mes "Ho não... já existe um ovo de páscoa escondido aqui neste local.";
	return;

_esconderOvo:
	mes "[Esconderijo]";
	mes "Este sim é um local seguro!";
	mes "";
	if(getarg(3)=="pedra") mes "* Você escondeu o seu ovo de páscoa atrás desta pedra.";
	if(getarg(3)=="placa") mes "* Você escondeu o seu ovo de páscoa atrás desta placa.";
	if(getarg(3)=="pilha de madeira") mes "* Você escondeu o seu ovo de páscoa atrás desta pilha de madeira.";
	if(getarg(3)=="poste de luz") mes "* Você escondeu o seu ovo de páscoa atrás deste poste de luz.";
	if(getarg(3)=="planta") mes "* Você escondeu o seu ovo de páscoa nas folhas desta planta.";
	if(getarg(3)=="palmeira") mes "* Você escondeu o seu ovo de páscoa na copa desta palmeira.";
	if(getarg(3)=="árvore      ") mes "* Você escondeu o seu ovo de páscoa no tronco oco desta árvore.";
	if(getarg(3)=="flor") mes "* Você escondeu o seu ovo de páscoa no meio destas flores.";
	if(getarg(3)=="ponte") mes "* Você escondeu o seu ovo de páscoa debaixo desta ponte.";
	if(getarg(3)=="caverna") mes "* Você escondeu o seu ovo de páscoa na entrada desta caverna.";
	if(getarg(3)=="cerca") mes "* Você escondeu o seu ovo de páscoa atrás desta cerca.";
	if(getarg(3)=="bueiro") mes "* Você escondeu o seu ovo de páscoa dentro deste bueiro.";
	if(getarg(3)=="vaso") mes "* Você escondeu o seu ovo de páscoa dentro deste vaso.";
	if(getarg(3)=="barril") mes "* Você escondeu o seu ovo de páscoa dentro deste barril.";
	if(getarg(3)=="trigo") mes "* Você escondeu o seu ovo de páscoa dentro deste trigo.";
	if(getarg(3)=="cactus") mes "* Você escondeu o seu ovo de páscoa entre os espinhos deste cactus.";
	if(getarg(3)=="ninho") mes "* Você escondeu o seu ovo de páscoa entre os ovos deste ninho.";
	if(getarg(3)=="monte de terra") mes "* Você escondeu o seu ovo de páscoa enterrado neste monte de terra.";
	delitem @ovoPascoa+@ovo, 1;
	set PASCOA2_escondeNum, rand(6); //- 16,67% de chance... 4 ovos no mapa 012
	set PASCOA2_escondeCont, PASCOA2_escondeCont+1;
	message strcharinfo(0), "Já escondi " +PASCOA2_escondeCont+ "/30 ovos de páscoa.";
	return;

//- Procurando ovos de páscoa PRATA ------------------------------------

_procurandoOvosPrata:
	if(@escondeNum==0) set @escondeNum,rand(6)+1; //- se 0, jogador acabou de logar... gerar novo rand().
	if(PASCOA2_escondeNum==@num) goto _encontrarOvoPrata;
	if(@escondeNum%6==@num%6) goto _encontrarOvo;
	goto _naoEncontrarOvo;

_encontrarOvoPrata:
	mes "[Esconderijo]";
	mes "Um ovo de páscoa PRATEADO!";
	mes "";
	if(getarg(3)=="pedra") mes "* Você encontrou um ovo de páscoa PRATEADO escondido atrás desta pedra.";
	if(getarg(3)=="placa") mes "* Você encontrou um ovo de páscoa PRATEADO escondido atrás desta placa.";
	if(getarg(3)=="pilha de madeira") mes "* Você encontrou um ovo de páscoa PRATEADO escondido atrás desta pilha de madeira.";
	if(getarg(3)=="poste de luz") mes "* Você encontrou um ovo de páscoa PRATEADO escondido atrás deste poste de luz.";
	if(getarg(3)=="planta") mes "* Você encontrou um ovo de páscoa PRATEADO escondido nas folhas desta planta.";
	if(getarg(3)=="palmeira") mes "* Você encontrou um ovo de páscoa PRATEADO escondido na copa desta palmeira.";
	if(getarg(3)=="árvore      ") mes "* Você encontrou um ovo de páscoa PRATEADO escondido no tronco oco desta árvore.";
	if(getarg(3)=="flor") mes "* Você encontrou um ovo de páscoa PRATEADO escondido no meio destas flores.";
	if(getarg(3)=="ponte") mes "* Você encontrou um ovo de páscoa PRATEADO escondido debaixo desta ponte.";
	if(getarg(3)=="caverna") mes "* Você encontrou um ovo de páscoa PRATEADO escondido na entrada desta caverna.";
	if(getarg(3)=="cerca") mes "* Você encontrou um ovo de páscoa PRATEADO escondido atrás desta cerca.";
	if(getarg(3)=="bueiro") mes "* Você encontrou um ovo de páscoa PRATEADO escondido dentro deste bueiro.";
	if(getarg(3)=="vaso") mes "* Você encontrou um ovo de páscoa PRATEADO escondido dentro deste vaso.";
	if(getarg(3)=="barril") mes "* Você encontrou um ovo de páscoa PRATEADO escondido dentro deste barril.";
	if(getarg(3)=="trigo") mes "* Você encontrou um ovo de páscoa PRATEADO escondido dentro deste trigo.";
	if(getarg(3)=="cactus") mes "* Você encontrou um ovo de páscoa PRATEADO escondido entre os espinhos deste cactus.";
	if(getarg(3)=="ninho") mes "* Você encontrou um ovo de páscoa PRATEADO escondido entre os ovos deste ninho.";
	if(getarg(3)=="monte de terra") mes "* Você encontrou um ovo de páscoa PRATEADO enterrado neste monte de terra.";
	getitem @ovoPascoaPrata, 1;
	set @escondeNum, rand(6)+1; //- ovos normais do desafio3.
	set PASCOA2_escondeNum, rand(54); //- 1,85% de chance... 1 só ovo em todos os mapas juntos
	set PASCOA2_escondeCont, PASCOA2_escondeCont+1;
	message strcharinfo(0), "Já encontrei " +PASCOA2_escondeCont+ "/10 ovos de páscoa prateados.";
	return;

//- Geral --------------------------------------------------------------

_longe:
	mes "[Esconderijo]";
	mes "Muito longe... melhor chegar mais perto.";
	return;

_explicaJogo:
	mes "[Esconderijo]";
	mes "Este é um esconderijo de ovos de páscoa.";
	mes "Fale com o Ceolho para saber como participar da brincadeira.";
	return;

_fimJogo:
	mes "[Esconderijo]";
	mes "Você já venceu todos os desafios do Coelho... deixe os ovos para os novatos.";
	return;

}

/**
 * Retorna qual o id do evento... eventos: 1..12, 0 para nenhum.
 * @return @evento informando o id do evento ativo. 0, caso nenhum esteja ativo.
 */
function	script	getEvento	{
	set @evento, 0;

	set @dia, gettime(5);
	set @hora, gettime(3);
	set @min, gettime(2);
	if (@dia<20 || @dia>24 || @min>45) return;

	if (@dia==20 && @hora==17) set @evento, 1;
	if (@dia==20 && @hora==21) set @evento, 2;
	if (@dia==21 && @hora==17) set @evento, 3;
	if (@dia==21 && @hora==21) set @evento, 4;
	if (@dia==22 && @hora==17) set @evento, 5;
	if (@dia==22 && @hora==21) set @evento, 6;
	if (@dia==23 && @hora==11) set @evento, 7;
	if (@dia==23 && @hora==17) set @evento, 8;
	if (@dia==23 && @hora==21) set @evento, 9;
	if (@dia==24 && @hora==11) set @evento, 10;
	if (@dia==24 && @hora==17) set @evento, 11;
	if (@dia==24 && @hora==21) set @evento, 12;
	return;
}

/**
 * Retorna qual o id do evento como global temporária... eventos: 1..12, 0 para nenhum.
 * @return @evento informando o id do evento ativo. 0, caso nenhum esteja ativo.
 */
function	script	getEvento2	{
	set $@evento, 0;

	set $@dia, gettime(5);
	set $@hora, gettime(3);
	set $@min, gettime(2);
	if ($@dia<20 || $@dia>24 || $@min>45) return;

	if ($@dia==20 && $@hora==17) set $@evento, 1;
	if ($@dia==20 && $@hora==21) set $@evento, 2;
	if ($@dia==21 && $@hora==17) set $@evento, 3;
	if ($@dia==21 && $@hora==21) set $@evento, 4;
	if ($@dia==22 && $@hora==17) set $@evento, 5;
	if ($@dia==22 && $@hora==21) set $@evento, 6;
	if ($@dia==23 && $@hora==11) set $@evento, 7;
	if ($@dia==23 && $@hora==17) set $@evento, 8;
	if ($@dia==23 && $@hora==21) set $@evento, 9;
	if ($@dia==24 && $@hora==11) set $@evento, 10;
	if ($@dia==24 && $@hora==17) set $@evento, 11;
	if ($@dia==24 && $@hora==21) set $@evento, 12;
	return;
}

/**
 * Script para dropar ovos dourados durante os horários de evento e
 * scipt para classificação no top15.
 *
 * @var @evento informa qual dos evento está ativo. 0, caso nenhum esteja.
 * Primeiro deve executar a função getEvento: 'callfunc "getEvento";'
 * @date segunda, 18 de abril de 2011
 * @author Diogo_RBG - http://diogorbg.blogspot.com
 */
function	script	dropOvoDourado	{
	// Uma única mensagem quando o evento Top15 estiver inativo.
	if(@evento==0 && $@PASCOA2_evento2!=@evento)
		announce "* O evento 'Top15 de Páscoa' está INATIVO.", 0;
	set $@PASCOA2_evento2, @evento;

	// Retorna se o evento Top15 não estiver ativo.
	if(@evento==0) return;

	// Rand para conseguir um ovo dourado.
	set @tmp, rand(100);
	if(@tmp>=6) return;
	getitem 3226, 1;
	set PASCOA2_item, PASCOA2_item+1;
	message strcharinfo(0), "Aeee!";

	// Identifica o primeiro jogador a conseguir um item no top15.
	if($@PASCOA2_evento==@evento) goto _pular0;
		set $@PASCOA2_evento, @evento;
		announce "* '"+strcharinfo(0)+"' coletou o primeiro Ovo de Páscoa Dourado do evento!", 0;
		gmcommand "@l #informacao '"+strcharinfo(0)+"' coletou o primeiro Ovo de Páscoa Dourado do evento!";
	_pular0:

	// Se puder entrar no final do placar || ser o primeiro a entrar na lista
	if ($PASCOA2_vetPlacar[$PASCOA2_numPlacar-1]<PASCOA2_item && $PASCOA2_numPlacar!=0) goto _pular1; //< Se não puder: _pula1
	//else
		set $PASCOA2_nomPlacar$[$PASCOA2_numPlacar], strcharinfo(0);
		set $PASCOA2_vetPlacar[$PASCOA2_numPlacar], PASCOA2_item;
		set $PASCOA2_lvlPlacar[$PASCOA2_numPlacar], BaseLevel;
		if ($PASCOA2_numPlacar<15) set $PASCOA2_numPlacar, $PASCOA2_numPlacar+1;
		return;
	_pular1:

	// Buscar nome no placar
	set @tmp, $PASCOA2_numPlacar; //< O padão é o ultimo do placar
	set @i, -1;
	_loop1: set @i,@i+1; if(@i>=$PASCOA2_numPlacar) goto _fimLoop1;
		if ($PASCOA2_nomPlacar$[@i]!=strcharinfo(0)) goto _loop1;
		//else
			set $PASCOA2_vetPlacar[@i], PASCOA2_item;
			set $PASCOA2_lvlPlacar[@i], BaseLevel;
			set @tmp, @i;
			goto _fimLoop1;
		//goto _loop1;
	_fimLoop1:

	// Subir no placar
	set @i, @tmp; //< Indice encontrado no loop1
	set @tmp, 0;
	_loop2: set @i,@i-1; if(@i<0) goto _fimLoop2;
		if ($PASCOA2_vetPlacar[@i]>=PASCOA2_item) set @i, -1;
			if(@i<0) goto _fimLoop2;
		//else
			set @tmp, 1;
			set $PASCOA2_nomPlacar$[@i+1], $PASCOA2_nomPlacar$[@i];
			set $PASCOA2_vetPlacar[@i+1], $PASCOA2_vetPlacar[@i];
			set $PASCOA2_lvlPlacar[@i+1], $PASCOA2_lvlPlacar[@i];
			set $PASCOA2_nomPlacar$[@i], strcharinfo(0);
			set $PASCOA2_vetPlacar[@i], PASCOA2_item;
			set $PASCOA2_lvlPlacar[@i], BaseLevel;
		goto _loop2;
	_fimLoop2:

	if (@tmp==1 && $PASCOA2_numPlacar<15) set $PASCOA2_numPlacar, $PASCOA2_numPlacar+1;
	return;
}
