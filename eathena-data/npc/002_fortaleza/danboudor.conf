// NPC Danboudor

005.gat,100,23,0	script	Danboudor	328,{

    if ($@Evento_Status == 1 && ControleDeEventos != $Controle_Eventos)
        goto L_Evento;
    if ($@Evento_Status == 1 && ControleDeEventos == $Controle_Eventos && $Controle_Eventos == 0)
        goto L_Evento;
    if ($@Evento_Status == 1 && ControleDeEventos == $Controle_Eventos)
        goto L_Voltar;
    if ((ControleDeEventos == $Controle_Eventos && $Controle_Eventos != 0) && (Grupo_Existente == $Vencedor_Grupo ||     Grupo_Existente == $Empatados[1] || Grupo_Existente == $Empatados[2] || Grupo_Existente == $Empatados[3] || Grupo_Existente == $Empatados[4] || Grupo_Existente == $Empatados[5] || Grupo_Existente == $Empatados[6] || Grupo_Existente == $Empatados[7] || Grupo_Existente == $Empatados[8] || Grupo_Existente == $Empatados[9] || Grupo_Existente == $Empatados[10] || Grupo_Existente == $Empatados[11] || Grupo_Existente == $Empatados[12] || Grupo_Existente == $Vencedor_Mortes_Grupo || Grupo_Existente == $Empatados_Mortes[1] || Grupo_Existente == $Empatados_Mortes[2] || Grupo_Existente == $Empatados_Mortes[3] || Grupo_Existente == $Empatados_Mortes[4] || Grupo_Existente == $Empatados_Mortes[5] || Grupo_Existente == $Empatados_Mortes[6] || Grupo_Existente == $Empatados_Mortes[7] || Grupo_Existente == $Empatados_Mortes[8] || Grupo_Existente == $Empatados_Mortes[9] || Grupo_Existente == $Empatados_Mortes[10] || Grupo_Existente == $Empatados_Mortes[11] || Grupo_Existente == $Empatados_Mortes[12]))
        goto L_Premio;

    mes "[Danboudor]";
    mes "\"Você NÃO faz parte do grupo vencedor do evento número " + $Controle_Eventos + ".\"";
    close;

L_Premio:
    mes "[Danboudor]";
    mes "\"Você faz parte do grupo vencedor do evento número " + $Controle_Eventos + ".\"";
    close;

L_Voltar:
    set Grupo_Existente, 0;
    set ControleDeEventos, 0;
    mes "[Danboudor]";
    mes "\"Você não deveria estar lá dentro? Quer que eu te mande de volta?\"";
    menu
        "Sim.", L_Entrada,
        "Não.", -;
    close;

L_Evento:
    mes "[" + strcharinfo(0) + "]";
    menu
        "Poderoso Danboudor, o que devo fazer?", -;

    mes "[Danboudor]";
    mes "\"Meu filho, você e sua Família (clã) devem atacar e dominar o maior número de Pilares de Érnegon.\"";
    next;

    mes "[" + strcharinfo(0) + "]";
    menu
        "Como fazemos isso Mestre dos Mestres?", -;

    mes "[Danboudor]";
    mes "\" Vocês devem atacar os Pilares de Érnegon até que eles sejam derrubados e se tornem propriedades de sua família.\"";
    next;
    mes "\"Quando o Pilar passar a ser da sua família, você deve protegê-lo para que não seja atacado por membros de outras famílias.\"";
    next;

    mes "[" + strcharinfo(0) + "]";
    menu
        "Hum... Compreendi. E depois?", -;

    mes "[Danboudor]";
    mes "\"Vocês devem preservar o maior número de pilares possível até que a batalha seja completada. Você vai batalhar?\"";
    next;

    mes "[" + strcharinfo(0) + "]";
    menu
        "Com certeza, defenderei a minha terra com meus amigos.", -,
        "Tenho medo, parece muito arriscado.", L_Fechar;

    mes "[Danboudor]";
    mes "\"Irei enfeitiça-lo e depois teletransportá-lo. Alohomora! Carpe Retractum!!!\"";
    next;
    mes $@Evento_Status;
    mes getcharid(1);
    if ($@Evento_Status != 1)
        close;
    if (getcharid(1) == 0)
        goto L_Sem_Grupo;
    set Grupo_Existente, 0;
    set @loop, 0;
    callsub S_Procura_Grupo;
    set @loop, 0;
    callsub S_Registra_Grupo;
    set @loop, 0;
    callsub S_Apresenta_Grupos;
    set @loop, 0;
    set ControleDeEventos, $Controle_Eventos;
    goto L_Entrada;
    close;

L_Fechar:
    close;

L_Sem_Grupo:
    mes "[Danboudor]";
    mes "Você não faz parte de uma família. Se você entrar, infelizmente não vai poder ajudar em nada.";
    close;

L_Muitos_Grupos:
    set @loop, 0;
    mes "[Danboudor]";
    mes "Já existem muitos grupos trabalhando para derrubar os pilares de Érnegon.";
    return;

S_Procura_Grupo:
    set @loop, @loop + 1;
    if ($@Grupos_AutoEvento$[@loop] == getpartyname(getcharid(1)))
        set Grupo_Existente, @loop;
    if (@loop > 12)
        return;
    goto S_Procura_Grupo;

S_Registra_Grupo:
    if (Grupo_Existente != 0)
        return;
    set @loop, @loop + 1;
    if ($@Grupos_AutoEvento$[@loop] == "")
        set Grupo_Existente, @loop;
    if ($@Grupos_AutoEvento$[@loop] == "")
        set $@Grupos_AutoEvento$[@loop], getpartyname(getcharid(1));
    if (Grupo_Existente != 0)
        return;
    if (@loop > 12)
        goto L_Muitos_Grupos;
    goto S_Registra_Grupo;

S_Apresenta_Grupos:
    if (Grupo_Existente == 1)
        goto Grupo1;
    if (Grupo_Existente == 2)
        goto Grupo2;
    if (Grupo_Existente == 3)
        goto Grupo3;
    if (Grupo_Existente == 4)
        goto Grupo4;
    if (Grupo_Existente == 5)
        goto Grupo5;
    if (Grupo_Existente == 6)
        goto Grupo6;
    if (Grupo_Existente == 7)
        goto Grupo7;
    if (Grupo_Existente == 8)
        goto Grupo8;
    if (Grupo_Existente == 9)
        goto Grupo9;
    if (Grupo_Existente == 10)
        goto Grupo10;
    if (Grupo_Existente == 11)
        goto Grupo11;
    if (Grupo_Existente == 12)
        goto Grupo12;

Grupo1:
    set @loop, @loop + 1;
    if ($@Grupo1$[@loop] != "" && $@Grupo1$[@loop] != strcharinfo(0))
        goto Grupo1;
    if ($@Grupo1$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo1$[@loop] == "")
        set $@Grupo1$[@loop], strcharinfo(0);
    if ($@Grupo1$[@loop] == strcharinfo(0))
        return;
    return;

Grupo2:
    set @loop, @loop + 1;
    if ($@Grupo2$[@loop] != "" && $@Grupo2$[@loop] != strcharinfo(0))
        goto Grupo2;
    if ($@Grupo2$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo2$[@loop] == "")
        set $@Grupo2$[@loop], strcharinfo(0);
    if ($@Grupo2$[@loop] == strcharinfo(0))
        return;
    return;

Grupo3:
    set @loop, @loop + 1;
    if ($@Grupo3$[@loop] != "" && $@Grupo3$[@loop] != strcharinfo(0))
        goto Grupo3;
    if ($@Grupo3$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo3$[@loop] == "")
        set $@Grupo3$[@loop], strcharinfo(0);
    if ($@Grupo3$[@loop] == strcharinfo(0))
        return;
    return;

Grupo4:
    set @loop, @loop + 1;
    if ($@Grupo4$[@loop] != "" && $@Grupo4$[@loop] != strcharinfo(0))
        goto Grupo4;
    if ($@Grupo4$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo4$[@loop] == "")
        set $@Grupo4$[@loop], strcharinfo(0);
    if ($@Grupo4$[@loop] == strcharinfo(0))
        return;
    return;

Grupo5:
    set @loop, @loop + 1;
    if ($@Grupo5$[@loop] != "" && $@Grupo5$[@loop] != strcharinfo(0))
        goto Grupo5;
    if ($@Grupo5$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo5$[@loop] == "")
        set $@Grupo5$[@loop], strcharinfo(0);
    if ($@Grupo5$[@loop] == strcharinfo(0))
        return;
    return;

Grupo6:
    set @loop, @loop + 1;
    if ($@Grupo6$[@loop] != "" && $@Grupo6$[@loop] != strcharinfo(0))
        goto Grupo6;
    if ($@Grupo6$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo6$[@loop] == "")
        set $@Grupo6$[@loop], strcharinfo(0);
    if ($@Grupo6$[@loop] == strcharinfo(0))
        return;
    return;

Grupo7:
    set @loop, @loop + 1;
    if ($@Grupo7$[@loop] != "" && $@Grupo7$[@loop] != strcharinfo(0))
        goto Grupo7;
    if ($@Grupo7$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo7$[@loop] == "")
        set $@Grupo7$[@loop], strcharinfo(0);
    if ($@Grupo7$[@loop] == strcharinfo(0))
        return;
    return;

Grupo8:
    set @loop, @loop + 1;
    if ($@Grupo8$[@loop] != "" && $@Grupo8$[@loop] != strcharinfo(0))
        goto Grupo8;
    if ($@Grupo8$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo8$[@loop] == "")
        set $@Grupo8$[@loop], strcharinfo(0);
    if ($@Grupo8$[@loop] == strcharinfo(0))
        return;
    return;

Grupo9:
    set @loop, @loop + 1;
    if ($@Grupo9$[@loop] != "" && $@Grupo9$[@loop] != strcharinfo(0))
        goto Grupo9;
    if ($@Grupo9$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo9$[@loop] == "")
        set $@Grupo9$[@loop], strcharinfo(0);
    if ($@Grupo9$[@loop] == strcharinfo(0))
        return;
    return;

Grupo10:
    set @loop, @loop + 1;
    if ($@Grupo10$[@loop] != "" && $@Grupo10$[@loop] != strcharinfo(0))
        goto Grupo10;
    if ($@Grupo10$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo10$[@loop] == "")
        set $@Grupo10$[@loop], strcharinfo(0);
    if ($@Grupo10$[@loop] == strcharinfo(0))
        return;
    return;

Grupo11:
    set @loop, @loop + 1;
    if ($@Grupo11$[@loop] != "" && $@Grupo11$[@loop] != strcharinfo(0))
        goto Grupo11;
    if ($@Grupo11$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo11$[@loop] == "")
        set $@Grupo11$[@loop], strcharinfo(0);
    if ($@Grupo11$[@loop] == strcharinfo(0))
        return;
    return;

Grupo12:
    set @loop, @loop + 1;
    if ($@Grupo12$[@loop] != "" && $@Grupo12$[@loop] != strcharinfo(0))
        goto Grupo12;
    if ($@Grupo12$[@loop] == strcharinfo(0))
        return;
    if ($@Grupo12$[@loop] == "")
        set $@Grupo12$[@loop], strcharinfo(0);
    if ($@Grupo12$[@loop] == strcharinfo(0))
        return;
    return;

L_Entrada:
    warp "002.gat", 100, 118;
    close;
}

005.gat,103,23,0	script	DEBUG	328,{

    if ($@Evento_Status == 1)
        goto L_Debug2;

L_Debug:
    mes "[DEBUG]";
    mes "\"O evento está desabilitado. Gostaria de habilitá-lo?\"";
    next;
    menu
        "DEBUG - Mostrar o valor de todas as variáveis envolvidas", L_Mostravars,
        "Habilitar no próximo minuto para ver os anúncios", L_Debug3,
        "Habilitar agora", -;

    set $@Evento_Debug, 1;
    mes "[DEBUG]";
    mes "\"Aguarde 5 segundos e converse com o danboudor.\"";
    close;

L_Debug2:
    mes "[DEBUG]";
    mes "\"O evento está habilitado. Gostaria de desabilitá-lo ou prosseguir normalmente?\"";
    next;
    menu
        "DEBUG - Mostrar o valor de todas as variáveis envolvidas", L_Mostravars,
        "Desabilitar", -,
        "Fechar", L_Fechar;

    set $@Evento_Debug, 0;
    mes "[DEBUG]";
    mes "\"Aguarde 5 segundos e converse comigo novamente.\"";
    close;

L_Debug3:
    set $@Evento_Debug, 2;
    mes "[DEBUG]";
    mes "\"Aguarde os anúncios\"";
    close;

L_Mostravars:
    mes "Status do evento: " + $@Evento_Status;
    mes "Status do modo Debug: " + $@Evento_Debug;
    next;
    mes "Grupo em que você foi cadastrado da ultima vez: " + Grupo_Existente;
    mes "Se o valor for zero, ou você nunca participou de um evento, ou você já conversou com o danboudor depois do último evento em que participou.";
    next;
    mes "ID do evento último evento em que você foi cadastrado: " + ControleDeEventos;
    mes "Esta ID você ganha assim que é cadastrado no evento. O valor dela é o mesmo da ID global do evento.";
    next;
    mes "ID GLOBAL do evento em vigência: " + $Controle_Eventos;
    mes "Em cada evento a ID global é aumentada em +1. Isso serve para fazer que só seja possível resgatar seu prêmio no período entre o fim do evento atual e o inicio do próximo.";
    next;
    if ($@Vencedor_Mortes == 0)
        mes "O grupo ganhador do evento em vigência foi o grupo " + $Vencedor_Grupo + " com " + $@Vencedor_Pilares +  " totens e " + $@Vencedor_Mortes + " vitorias em pvp, que não foram levadas em consideração.";
    if ($@Vencedor_Mortes != 0)
        mes "O grupo ganhador do evento em vigência foi o grupo " + $Vencedor_Mortes_Grupo +  " com " + $@Vencedor_Pilares +  " totens e " + $@Vencedor_Mortes + " vitorias em pvp";
    if (getarraysize($Empatados) == 1)
        mes "Não houve empate.";
    if (getarraysize($Empatados) != 1 && getarraysize($Empatados_Mortes) == 1 && $@Vencedor_Mortes == 0)
        mes "Houve empate, mas ninguém matou ninguém, o que prejudicou o critério de desempate.";
    if (getarraysize($Empatados) != 1 && getarraysize($Empatados_Mortes) == 1 && $@Vencedor_Mortes != 0)
        mes "Houve empate, e o grupo " + $Vencedor_Mortes_Grupo + " venceu pelo critério de desempate.";
    if (getarraysize($Empatados) != 1 && getarraysize($Empatados_Mortes) != 1)
        mes "Houve empate no número de totens e no numero de vitorias em pvp entre o grupo ganhador e os grupos: " + $Empatados_Mortes[1] + " - " + $Empatados_Mortes[2] + " - " + $Empatados_Mortes[3] + " - " + $Empatados_Mortes[4] + " - " + $Empatados_Mortes[5] + " - " + $Empatados_Mortes[6] + " - " + $Empatados_Mortes[7] + " - " + $Empatados_Mortes[8] + " - " + $Empatados_Mortes[9] + " - " + $Empatados_Mortes[10] + " - " + $Empatados_Mortes[11] + " - " + $Empatados_Mortes[12];
    next;
    mes "Tempo de inicio do evento(só deve aparecer se Status do evento = 1): " + $@Evento_Inicio;
    next;
    if (getarraysize($@Grupos_AutoEvento$) == 1)
        goto L_2;
L_1:
    mes "Grupos cadastrados(só deve aparecer se Status do evento = 1): "
    + $@Grupos_AutoEvento$[1]
    + $@Grupos_AutoEvento$[2]
    + $@Grupos_AutoEvento$[3]
    + $@Grupos_AutoEvento$[4]
    + $@Grupos_AutoEvento$[5]
    + $@Grupos_AutoEvento$[6]
    + $@Grupos_AutoEvento$[7]
    + $@Grupos_AutoEvento$[8]
    + $@Grupos_AutoEvento$[9]
    + $@Grupos_AutoEvento$[10]
    + $@Grupos_AutoEvento$[11]
    + $@Grupos_AutoEvento$[12];
    goto L_3;
L_2:
    mes "Nenhum grupo cadastrado.";
L_3:
    next;
    if (getarraysize($@Grupo1$) != 1)
        mes "Há pessoas cadastradas no grupo 1";
    if (getarraysize($@Grupo1$) == 1)
        mes "Ninguém no grupo 1";
    if (getarraysize($@Grupo2$) != 1)
        mes "Há pessoas cadastradas no grupo 2";
    if (getarraysize($@Grupo2$) == 1)
        mes "Ninguém no grupo 2";
    if (getarraysize($@Grupo3$) != 1)
        mes "Há pessoas cadastradas no grupo 3";
    if (getarraysize($@Grupo3$) == 1)
        mes "Ninguém no grupo 3";
    if (getarraysize($@Grupo4$) != 1)
        mes "Há pessoas cadastradas no grupo 4";
    if (getarraysize($@Grupo4$) == 1)
        mes "Ninguém no grupo 4";
    if (getarraysize($@Grupo5$) != 1)
        mes "Há pessoas cadastradas no grupo 5";
    if (getarraysize($@Grupo5$) == 1)
        mes "Ninguém no grupo 5";
    if (getarraysize($@Grupo6$) != 1)
        mes "Há pessoas cadastradas no grupo 6";
    if (getarraysize($@Grupo6$) == 1)
        mes "Ninguém no grupo 6";
    if (getarraysize($@Grupo7$) != 1)
        mes "Há pessoas cadastradas no grupo 7";
    if (getarraysize($@Grupo7$) == 1)
        mes "Ninguém no grupo 7";
    if (getarraysize($@Grupo8$) != 1)
        mes "Há pessoas cadastradas no grupo 8";
    if (getarraysize($@Grupo8$) == 1)
        mes "Ninguém no grupo 8";
    if (getarraysize($@Grupo9$) != 1)
        mes "Há pessoas cadastradas no grupo 9";
    if (getarraysize($@Grupo9$) == 1)
        mes "Ninguém no grupo 9";
    if (getarraysize($@Grupo10$) != 1)
        mes "Há pessoas cadastradas no grupo 10";
    if (getarraysize($@Grupo10$) == 1)
        mes "Ninguém no grupo 10";
    if (getarraysize($@Grupo11$) != 1)
        mes "Há pessoas cadastradas no grupo 11";
    if (getarraysize($@Grupo11$) == 1)
        mes "Ninguém no grupo 11";
    if (getarraysize($@Grupo12$) != 1)
        mes "Há pessoas cadastradas no grupo 12";
    if (getarraysize($@Grupo12$) == 1)
        mes "Ninguém no grupo 12";
    next;
    if (getarraysize($@Pilares_Donos) == 1)
        mes "Nenhum Pilar tem dono";
    if (getarraysize($@Pilares_Donos) == 1)
        goto L_4;
    mes "Pilar 1 pertence ao grupo número " + $@Pilares_Donos[1];
    mes "Pilar 2 pertence ao grupo número " + $@Pilares_Donos[2];
    mes "Pilar 3 pertence ao grupo número " + $@Pilares_Donos[3];
    mes "Pilar 4 pertence ao grupo número " + $@Pilares_Donos[4];
    mes "Pilar 5 pertence ao grupo número " + $@Pilares_Donos[5];
    mes "Pilar 6 pertence ao grupo número " + $@Pilares_Donos[6];
    mes "Pilar 7 pertence ao grupo número " + $@Pilares_Donos[7];
    mes "Pilar 8 pertence ao grupo número " + $@Pilares_Donos[8];
    mes "Pilar 9 pertence ao grupo número " + $@Pilares_Donos[9];
    mes "Pilar 10 pertence ao grupo número " + $@Pilares_Donos[10];
    mes "Pilar 11 pertence ao grupo número " + $@Pilares_Donos[11];
    mes "Pilar 12 pertence ao grupo número " + $@Pilares_Donos[12];
L_4:
    next;
    mes "verificando se o indice zero está preenchido em alguma das variaveis";
    next;
    mes $@Grupos_AutoEvento$[0];
    mes $@Grupo1$[0];
    mes $@Grupo2$[0];
    mes $@Grupo3$[0];
    mes $@Grupo4$[0];
    mes $@Grupo5$[0];
    mes $@Grupo6$[0];
    mes $@Grupo7$[0];
    mes $@Grupo8$[0];
    mes $@Grupo9$[0];
    mes $@Grupo10$[0];
    mes $@Grupo11$[0];
    mes $@Grupo12$[0];
    mes $@Pilares_Donos[0];
    close;

L_Fechar:
    close;

}
