// NPC que controla quem matou os totems

002.gat,107,115,0	script	#Controle	45,{

	end;

L_Iniciar:
	monster "002.gat", 93, 105, "", 1014, 1, "#Controle::OnTotem1Death";
	monster "002.gat", 93, 100, "", 1014, 1, "#Controle::OnTotem2Death";
	monster "002.gat", 93, 95, "", 1014, 1, "#Controle::OnTotem3Death";
	monster "002.gat", 93, 90, "", 1014, 1, "#Controle::OnTotem4Death";
	monster "002.gat", 93, 85, "", 1014, 1, "#Controle::OnTotem5Death";
	monster "002.gat", 105, 105, "", 1014, 1, "#Controle::OnTotem6Death";
	monster "002.gat", 105, 100, "", 1014, 1, "#Controle::OnTotem7Death";
	monster "002.gat", 105, 95, "", 1014, 1, "#Controle::OnTotem8Death";
	monster "002.gat", 105, 90, "", 1014, 1, "#Controle::OnTotem9Death";
	monster "002.gat", 105, 85, "", 1014, 1, "#Controle::OnTotem10Death";
	set $@EVENTO_STATUS, 1;
	set $@EVENTO_INICIO, gettimetick(2);
	set $CONTROLE_EVENTOS, $CONTROLE_EVENTOS + 1;
	set $@VENCEDOR_TOTENS, 0;
	set $@VENCEDOR, 0;
	set $@EMPATADOS[1], 0;
	set $@EMPATADOS[2], 0;
	set $@EMPATADOS[3], 0;
	set $@EMPATADOS[4], 0;
	set $@EMPATADOS[5], 0;
	set $@EMPATADOS[6], 0;
	set $@EMPATADOS[7], 0;
	set $@EMPATADOS[8], 0;
	set $@EMPATADOS[9], 0;
	set $@EMPATADOS[10], 0;
	end;

OnTimer5000:
	setnpctimer 0;
//
//	Modo Normal
//
//	if (gettime(4) != 6 || gettime(3) < 18) end;
//	if (gettime(3) > 20 && $@EVENTO_STATUS == 1) goto L_Limpar;
//	if (gettime(3) == 18 || (gettime(3) == 19 && gettime(2) == 0)) goto L_Anuncios;
//
//	Modo debug
	if ($@EVENTO_STATUS == 0 && $@EVENTO_DEBUG == 1) goto L_Iniciar;
	if ($@EVENTO_STATUS == 1 && $@EVENTO_DEBUG == 0) goto L_Limpar;
	if ($@EVENTO_STATUS == 1) goto L_Checar_Tempo;
	end;

OnTotem1Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[1] != @loop) announce "O totem 1 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[1] != @loop) set $@Totemdono[1], @loop;
	monster "002.gat", 93, 105, "", 1014, 1, "#Controle::OnTotem1Death";
	end;

OnTotem2Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[2] != @loop) announce "O totem 2 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[2] != @loop) set $@Totemdono[2], @loop;
	monster "002.gat", 93, 100, "", 1014, 1, "#Controle::OnTotem2Death";
	end;

OnTotem3Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[3] != @loop) announce "O totem 3 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[3] != @loop) set $@Totemdono[3], @loop;
	monster "002.gat", 93, 95, "", 1014, 1, "#Controle::OnTotem3Death";
	end;

OnTotem4Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[4] != @loop) announce "O totem 4 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[4] != @loop) set $@Totemdono[4], @loop;
	monster "002.gat", 93, 90, "", 1014, 1, "#Controle::OnTotem4Death";
	end;

OnTotem5Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[5] != @loop) announce "O totem 5 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[5] != @loop) set $@Totemdono[5], @loop;
	monster "002.gat", 93, 85, "", 1014, 1, "#Controle::OnTotem5Death";
	end;

OnTotem6Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[6] != @loop) announce "O totem 6 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[6] != @loop) set $@Totemdono[6], @loop;
	monster "002.gat", 105, 105, "", 1014, 1, "#Controle::OnTotem6Death";
	end;

OnTotem7Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[7] != @loop) announce "O totem 7 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[7] != @loop) set $@Totemdono[7], @loop;
	monster "002.gat", 105, 100, "", 1014, 1, "#Controle::OnTotem7Death";
	end;

OnTotem8Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[8] != @loop) announce "O totem 8 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[8] != @loop) set $@Totemdono[8], @loop;
	monster "002.gat", 105, 95, "", 1014, 1, "#Controle::OnTotem8Death";
	end;

OnTotem9Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[9] != @loop) announce "O totem 9 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[9] != @loop) set $@Totemdono[9], @loop;
	monster "002.gat", 105, 90, "", 1014, 1, "#Controle::OnTotem9Death";
	end;

OnTotem10Death:
	set @loop, 0;
	callsub S_QUALGRUPO;
	if ($@Totemdono[10] != @loop) announce "O totem 10 foi derrubado pela família " + getpartyname(getcharid(1)), 0;
	if ($@Totemdono[10] != @loop) set $@Totemdono[10], @loop;
	monster "002.gat", 105, 85, "", 1014, 1, "#Controle::OnTotem10Death";
	end;

L_Anuncios:
	if (gettime(2) == 35 && $@Anuncios == 0) goto L_Anuncio1;
	if (gettime(2) == 40 && $@Anuncios == 1) goto L_Anuncio2;
	if (gettime(2) == 45 && $@Anuncios == 2) goto L_Anuncio3;
	if (gettime(2) == 50 && $@Anuncios == 3) goto L_Anuncio4;
	if (gettime(2) == 55 && $@Anuncios == 4) goto L_Anuncio5;
	if (gettime(2) == 0 && $@Anuncios == 5) goto L_Anuncio6;


L_Anuncio1:
	announce "Os Pilares de Érnegon que sustentam o Mundo de Mana passaram a sofrer instabilidades por causa do alinhamento cósmico que envolvem as forças do universo, autoridades mágicas estimam que tal período durará cerca de um milênio.", 0;
	set $@Anuncios, 1;
	end;

L_Anuncio2:
	announce "Desde eras mitólogicas os Pilares de Érnegon deste mundo estavam invisíveis na região onde se encontra o Castelo Brhamir, para nos resguardar de toda sorte de males.", 0;
	set $@Anuncios, 2;
	end;

L_Anuncio3:
	announce "Por conta desse período de trevas que estamos atrevessando, os Pilares de Érnegon estão enfraquecidos e visíveis no Jardim do Castelo, sofrendo nesse exato momento ataques de criaturas do submundo. O destino do Mundo de Mana depende desses pilares.", 0;
	set $@Anuncios, 3;
	end;

L_Anuncio4:
	announce "Tradicionalmente os segredos desse mundo ficaram restrito às fadas do Reino de Lilith, segundo Ivanize reza a lenda que os Piláres de Érnegon devem ser distruídos por membros da mesma Família para serem estabilizados e renovados, mediante habilitação mágica.", 0;
	set $@Anuncios, 4;
	end;

L_Anuncio5:
	announce "Os Alquimistas do Mundo de Mana uniram poderes para dispertarem o Mestre do Magos, Danboudor. Somente ele poderá fazer a habilitação mágica das Famílias para renovarem os Pilares de Érnegon. Ele estará por pouco tempo no portão do Castelo.", 0;
	set $@Anuncios, 5;
	end;

L_Anuncio6:
	announce "A batalha pela sobrevivência e perpetuação dos seres vivos deste mundo é trágica e violenta... Apenas uma Família poderá garantir a vida no Mundo de Mana! Ao ataque cavaleiros e amazonas!!!", 0;
	set $@Anuncios, 0;
	goto L_Iniciar;

L_Checar_Tempo:
	if (gettimetick(2) - $@EVENTO_INICIO > 60) goto L_Fim_Evento;
	end;

L_Fim_Evento:
	set $@loop, 0;
	callsub S_CONTAGEM;
	set $@loop, 0;
	set $@VENCEDOR, 0;
	set $@VENCEDOR_TOTENS, 0;
	callsub S_COMPARA;
	callsub S_REPETIDOS;
	if ($@VENCEDOR_TOTENS != 0 && getarraysize($@EMPATADOS) == 1) announce "A família " + $@GRUPOS_AUTOEVENTO$[$@VENCEDOR] + " capturou " + $@VENCEDOR_TOTENS + " Totens e ganhou o evento!", 0;
	if ($@VENCEDOR_TOTENS == 0) announce "Nenhum totem foi derrubado. Ninguém ganhou. :D", 0;
	if ($@VENCEDOR_TOTENS != 0 && getarraysize($@EMPATADOS) != 1) goto L_Anuncia_Empate;
	goto L_Limpar;

L_Anuncia_Empate:
	announce "Os vencedores foram as seguintes famílias, que derrubaram " + $@VENCEDOR_TOTENS + " totens cada uma: ", 0;
	announce "Família " + $@GRUPOS_AUTOEVENTO$[$@VENCEDOR], 0;
	if ($@EMPATADOS[1] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[1], 0;
	if ($@EMPATADOS[2] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[2], 0;
	if ($@EMPATADOS[3] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[3], 0;
	if ($@EMPATADOS[4] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[4], 0;
	if ($@EMPATADOS[5] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[5], 0;
	if ($@EMPATADOS[6] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[6], 0;
	if ($@EMPATADOS[7] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[7], 0;
	if ($@EMPATADOS[8] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[8], 0;
	if ($@EMPATADOS[9] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[9], 0;
	if ($@EMPATADOS[10] != 0) announce "Família " + $@GRUPOS_AUTOEVENTO$[10], 0;
	goto L_Limpar;

S_QUALGRUPO:
	set @loop, @loop + 1;
	if ($@GRUPOS_AUTOEVENTO$[@loop] == getpartyname(getcharid(1))) return;
	if (@loop > 10) message strcharinfo(0), "nao achei seu grupo!";
	if (@loop > 10) return;
	goto S_QUALGRUPO;

S_CONTAGEM:
	set $@loop, $@loop + 1;
	if ($@loop > 10) return;
	if ($@Totemdono[$@loop] == 1) set $@GRUPO1_TOTENS, $@GRUPO1_TOTENS + 1;
	if ($@Totemdono[$@loop] == 2) set $@GRUPO2_TOTENS, $@GRUPO2_TOTENS + 1;
	if ($@Totemdono[$@loop] == 3) set $@GRUPO3_TOTENS, $@GRUPO3_TOTENS + 1;
	if ($@Totemdono[$@loop] == 4) set $@GRUPO4_TOTENS, $@GRUPO4_TOTENS + 1;
	if ($@Totemdono[$@loop] == 5) set $@GRUPO5_TOTENS, $@GRUPO5_TOTENS + 1;
	if ($@Totemdono[$@loop] == 6) set $@GRUPO6_TOTENS, $@GRUPO6_TOTENS + 1;
	if ($@Totemdono[$@loop] == 7) set $@GRUPO7_TOTENS, $@GRUPO7_TOTENS + 1;
	if ($@Totemdono[$@loop] == 8) set $@GRUPO8_TOTENS, $@GRUPO8_TOTENS + 1;
	if ($@Totemdono[$@loop] == 9) set $@GRUPO9_TOTENS, $@GRUPO9_TOTENS + 1;
	if ($@Totemdono[$@loop] == 10) set $@GRUPO10_TOTENS, $@GRUPO10_TOTENS + 1;
	goto S_CONTAGEM;

S_COMPARA:
	if ($@GRUPO1_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,1;
	if ($@GRUPO1_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO1_TOTENS;
	if ($@GRUPO2_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,2;
	if ($@GRUPO2_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO2_TOTENS;
	if ($@GRUPO3_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,3;
	if ($@GRUPO3_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO3_TOTENS;
	if ($@GRUPO4_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,4;
	if ($@GRUPO4_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO4_TOTENS;
	if ($@GRUPO5_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,5;
	if ($@GRUPO5_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO5_TOTENS;
	if ($@GRUPO6_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,6;
	if ($@GRUPO6_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO6_TOTENS;
	if ($@GRUPO7_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,7;
	if ($@GRUPO7_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO7_TOTENS;
	if ($@GRUPO8_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,8;
	if ($@GRUPO8_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO8_TOTENS;
	if ($@GRUPO9_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,9;
	if ($@GRUPO9_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO9_TOTENS;
	if ($@GRUPO10_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR,10;
	if ($@GRUPO10_TOTENS > $@VENCEDOR_TOTENS) set $@VENCEDOR_TOTENS, $@GRUPO10_TOTENS;
	return;

S_REPETIDOS:
	if ($@VENCEDOR_TOTENS == 0) return;
	if ($@VENCEDOR != 1 && $@GRUPO1_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[1], 1;
	if ($@VENCEDOR != 2 && $@GRUPO2_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[2], 2;
	if ($@VENCEDOR != 3 && $@GRUPO3_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[3], 3;
	if ($@VENCEDOR != 4 && $@GRUPO4_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[4], 4;
	if ($@VENCEDOR != 5 && $@GRUPO5_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[5], 5;
	if ($@VENCEDOR != 6 && $@GRUPO6_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[6], 6;
	if ($@VENCEDOR != 7 && $@GRUPO7_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[7], 7;
	if ($@VENCEDOR != 8 && $@GRUPO8_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[8], 8;
	if ($@VENCEDOR != 9 && $@GRUPO9_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[9], 9;
	if ($@VENCEDOR != 10 && $@GRUPO10_TOTENS == $@VENCEDOR_TOTENS) set $@EMPATADOS[10], 10;
	return;

L_Limpar:
	set $@EVENTO_STATUS, 0;
	set $@EVENTO_DEBUG, 0;
	set $@EVENTO_INICIO, 0;
	set $@GRUPOS_AUTOEVENTO$[1], "";
	set $@GRUPOS_AUTOEVENTO$[2], "";
	set $@GRUPOS_AUTOEVENTO$[3], "";
	set $@GRUPOS_AUTOEVENTO$[4], "";
	set $@GRUPOS_AUTOEVENTO$[5], "";
	set $@GRUPOS_AUTOEVENTO$[6], "";
	set $@GRUPOS_AUTOEVENTO$[7], "";
	set $@GRUPOS_AUTOEVENTO$[8], "";
	set $@GRUPOS_AUTOEVENTO$[9], "";
	set $@GRUPOS_AUTOEVENTO$[10], "";
	set $@GRUPO1$[1], "";
	set $@GRUPO1$[2], "";
	set $@GRUPO1$[3], "";
	set $@GRUPO1$[4], "";
	set $@GRUPO1$[5], "";
	set $@GRUPO1$[6], "";
	set $@GRUPO1$[7], "";
	set $@GRUPO1$[8], "";
	set $@GRUPO1$[9], "";
	set $@GRUPO1$[10], "";
	set $@GRUPO2$[1], "";
	set $@GRUPO2$[2], "";
	set $@GRUPO2$[3], "";
	set $@GRUPO2$[4], "";
	set $@GRUPO2$[5], "";
	set $@GRUPO2$[6], "";
	set $@GRUPO2$[7], "";
	set $@GRUPO2$[8], "";
	set $@GRUPO2$[9], "";
	set $@GRUPO2$[10], "";
	set $@GRUPO3$[1], "";
	set $@GRUPO3$[2], "";
	set $@GRUPO3$[3], "";
	set $@GRUPO3$[4], "";
	set $@GRUPO3$[5], "";
	set $@GRUPO3$[6], "";
	set $@GRUPO3$[7], "";
	set $@GRUPO3$[8], "";
	set $@GRUPO3$[9], "";
	set $@GRUPO3$[10], "";
	set $@GRUPO4$[1], "";
	set $@GRUPO4$[2], "";
	set $@GRUPO4$[3], "";
	set $@GRUPO4$[4], "";
	set $@GRUPO4$[5], "";
	set $@GRUPO4$[6], "";
	set $@GRUPO4$[7], "";
	set $@GRUPO4$[8], "";
	set $@GRUPO4$[9], "";
	set $@GRUPO4$[10], "";
	set $@GRUPO5$[1], "";
	set $@GRUPO5$[2], "";
	set $@GRUPO5$[3], "";
	set $@GRUPO5$[4], "";
	set $@GRUPO5$[5], "";
	set $@GRUPO5$[6], "";
	set $@GRUPO5$[7], "";
	set $@GRUPO5$[8], "";
	set $@GRUPO5$[9], "";
	set $@GRUPO5$[10], "";
	set $@GRUPO6$[1], "";
	set $@GRUPO6$[2], "";
	set $@GRUPO6$[3], "";
	set $@GRUPO6$[4], "";
	set $@GRUPO6$[5], "";
	set $@GRUPO6$[6], "";
	set $@GRUPO6$[7], "";
	set $@GRUPO6$[8], "";
	set $@GRUPO6$[9], "";
	set $@GRUPO6$[10], "";
	set $@GRUPO7$[1], "";
	set $@GRUPO7$[2], "";
	set $@GRUPO7$[3], "";
	set $@GRUPO7$[4], "";
	set $@GRUPO7$[5], "";
	set $@GRUPO7$[6], "";
	set $@GRUPO7$[7], "";
	set $@GRUPO7$[8], "";
	set $@GRUPO7$[9], "";
	set $@GRUPO7$[10], "";
	set $@GRUPO8$[1], "";
	set $@GRUPO8$[2], "";
	set $@GRUPO8$[3], "";
	set $@GRUPO8$[4], "";
	set $@GRUPO8$[5], "";
	set $@GRUPO8$[6], "";
	set $@GRUPO8$[7], "";
	set $@GRUPO8$[8], "";
	set $@GRUPO8$[9], "";
	set $@GRUPO8$[10], "";
	set $@GRUPO9$[1], "";
	set $@GRUPO9$[2], "";
	set $@GRUPO9$[3], "";
	set $@GRUPO9$[4], "";
	set $@GRUPO9$[5], "";
	set $@GRUPO9$[6], "";
	set $@GRUPO9$[7], "";
	set $@GRUPO9$[8], "";
	set $@GRUPO9$[9], "";
	set $@GRUPO9$[10], "";
	set $@GRUPO10$[1], "";
	set $@GRUPO10$[2], "";
	set $@GRUPO10$[3], "";
	set $@GRUPO10$[4], "";
	set $@GRUPO10$[5], "";
	set $@GRUPO10$[6], "";
	set $@GRUPO10$[7], "";
	set $@GRUPO10$[8], "";
	set $@GRUPO10$[9], "";
	set $@GRUPO10$[10], "";
	set $@GRUPO1_TOTENS, 0;
	set $@GRUPO2_TOTENS, 0;
	set $@GRUPO3_TOTENS, 0;
	set $@GRUPO4_TOTENS, 0;
	set $@GRUPO5_TOTENS, 0;
	set $@GRUPO6_TOTENS, 0;
	set $@GRUPO7_TOTENS, 0;
	set $@GRUPO8_TOTENS, 0;
	set $@GRUPO9_TOTENS, 0;
	set $@GRUPO10_TOTENS, 0;
	set $@Totemdono[1], 0;
	set $@Totemdono[2], 0;
	set $@Totemdono[3], 0;
	set $@Totemdono[4], 0;
	set $@Totemdono[5], 0;
	set $@Totemdono[6], 0;
	set $@Totemdono[7], 0;
	set $@Totemdono[8], 0;
	set $@Totemdono[9], 0;
	set $@Totemdono[10], 0;
	killmonster "002.gat", "#Controle::OnTotem1Death";
	killmonster "002.gat", "#Controle::OnTotem2Death";
	killmonster "002.gat", "#Controle::OnTotem3Death";
	killmonster "002.gat", "#Controle::OnTotem4Death";
	killmonster "002.gat", "#Controle::OnTotem5Death";
	killmonster "002.gat", "#Controle::OnTotem6Death";
	killmonster "002.gat", "#Controle::OnTotem7Death";
	killmonster "002.gat", "#Controle::OnTotem8Death";
	killmonster "002.gat", "#Controle::OnTotem9Death";
	killmonster "002.gat", "#Controle::OnTotem10Death";
	end;

onInit:
	initnpctimer;
	end;

}
